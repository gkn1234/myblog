<!--
 * @Descripttion: 
 * @version: 
 * @Author: Guo Kainan
 * @Date: 2021-04-25 11:48:47
 * @LastEditors: Guo Kainan
 * @LastEditTime: 2021-04-26 16:45:49
-->
# 2021/4/25
遇到了SSR环境下自定义指令报错 Custom directive is missing corresponding SSR transform and will be ignored

解决方案：[SSR自定义指令解决](https://blog.csdn.net/theoneEmperor/article/details/114087464)

与Vue3的编译模块有关，以后再仔细研究

# 2021/4/26

### 上Serverless
- 上了Serverless，但是sls.js入口不支持异步函数，需要自定义app.slsInitialize，详见 [tencent-express文档](https://github.com/serverless-components/tencent-express)
- 部署后，报错 net::ERR_CONTENT_DECODING_FAILED 200 (OK)，因为腾讯云的API网关默认开启了gzip压缩，所以express应用不要再用 `compression` 插件重复gzip压缩了

### 静态资源托管
- 生产环境下，需要进行静态资源托管：[静态资源托管改造](https://cloud.tencent.com/document/product/1242/49653)。
- 腾讯的文档中没有告诉我们，Express应用应该怎么配置，但是我还是找到了方法

首先按照文档配好yml文件，指定好存储桶。[yml配置参数解析](https://github.com/serverless-components/tencent-framework-components/blob/master/docs/configure.md)
```
  staticConf:
    cosConf:
      bucket: myblog
      sources:
        - src: dist/client
          targetDir: /
```

然后在 `vite.config.js` 中简单配置一下base字段即可，[公共基础路径](https://cn.vitejs.dev/guide/build.html#public-base-path)

这样在生产环境下，所有的资源都会被加上COS所对应的前缀URL

```js
// vite.config.js
module.exports = {
  // ...
  base: process.env.NODE_ENV === 'production' ? CONFIG.cosUrl : '/',
  // ...
}
```
